<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>ç®€æ˜“è®ºå›</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>

<body>
    <header class="navbar">
        <div class="logo">ç®€æ˜“è®ºå›</div>
        <input class="search" type="text" id="searchInput" placeholder="æœç´¢ä½ æ„Ÿå…´è¶£çš„å†…å®¹">
        <div class="user">
            <button id="loginBtn">ç™»å½•</button>
            <button id="writeBtn" style="margin-left: 10px; background:#28a745;">å‘å¸–</button>
        </div>
    </header>

    <div class="main-grid">
        <aside class="left">
            <ul>
                <li id="homeLink">é¦–é¡µ</li>
                <li id="hotLink">çƒ­é—¨</li>
                <li id="followLink">å…³æ³¨</li>
            </ul>
        </aside>

        <main class="center">
            <div class="feed" id="postList">
                <!-- å¸–å­å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                <div class="question-card">
                    <h3>æ¬¢è¿ä½¿ç”¨ç®€æ˜“è®ºå›</h3>
                    <p>æ­£åœ¨åŠ è½½å¸–å­åˆ—è¡¨...</p>
                </div>
            </div>
        </main>

        <aside class="right">
            <div class="recommend">
                <h4>æ¨èå†…å®¹</h4>
                <ul>
                    <li>ä»Šæ—¥çƒ­é—¨è¯é¢˜</li>
                    <li>æ¯å‘¨ç²¾é€‰</li>
                    <li>è¿‘æœŸæ´»åŠ¨</li>
                </ul>
            </div>
        </aside>
    </div>

    <footer class="footer">
        &copy; 2025 ç®€æ˜“è®ºå›æ¼”ç¤º
    </footer>

    <script>
        // é¡µé¢å¯¼èˆª
        document.getElementById('loginBtn').addEventListener('click', function () {
            window.location.href = '/login';
        });

        document.getElementById('writeBtn').addEventListener('click', function () {
            window.location.href = '/write';
        });

        // åŠ è½½å¸–å­åˆ—è¡¨
        window.onload = function () {
            fetch('/api/posts')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 0) {
                        const postListDiv = document.getElementById('postList');
                        postListDiv.innerHTML = ''; // æ¸…ç©ºåŠ è½½æç¤º

                        if (data.posts.length === 0) {
                            postListDiv.innerHTML = '<div class="question-card"><h3>æš‚æ— å¸–å­</h3><p>å¿«æ¥å‘å¸ƒç¬¬ä¸€ç¯‡å¸–å­å§ï¼</p></div>';
                            return;
                        }

                        // æ¸²æŸ“å¸–å­åˆ—è¡¨
                        data.posts.forEach(post => {
                            const date = new Date(post.create_time);
                            const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;

                            const postCard = document.createElement('div');
                            postCard.className = 'question-card';
                            postCard.innerHTML = `
                <h3>${post.title}</h3>
                <p>${post.content.length > 100 ? post.content.substring(0, 100) + '...' : post.content}</p>
                <div style="margin-top: 10px; font-size: 14px; color: #888;">
                  <span>ç”¨æˆ·ID: ${post.user_id}</span> | 
                  <span>å‘å¸ƒäº: ${formattedDate}</span> | 
                  <span>ğŸ‘ ${post.like_count}</span> | 
                  <span>ğŸ’¬ ${post.comment_count}</span>
                </div>
              `;

                            // ç‚¹å‡»å¸–å­è·³è½¬åˆ°è¯¦æƒ…é¡µ
                            postCard.style.cursor = 'pointer';
                            postCard.addEventListener('click', function () {
                                window.location.href = `/blog/${post.id}`;
                            });

                            postListDiv.appendChild(postCard);
                        });
                    } else {
                        console.error('åŠ è½½å¸–å­å¤±è´¥:', data.msg);
                    }
                })
                .catch(error => {
                    console.error('ç½‘ç»œé”™è¯¯:', error);
                    document.getElementById('postList').innerHTML =
                        '<div class="question-card"><h3>åŠ è½½å¤±è´¥</h3><p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</p></div>';
                });
        };

        // æœç´¢åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.trim();
                if (searchTerm) {
                    window.location.href = `/?key=${encodeURIComponent(searchTerm)}`;
                }
            }
        });
    </script>
</body>

</html>